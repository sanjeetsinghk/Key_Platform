<div class="grid p-fluid">
    <p-toast/>
    <div class="col-9">
        <p-card header="Entity" class="w-100 w-full">
            <div class="grid p-fluid">            
                
                <div class="col-5" >                      
                    <p-dropdown 
                    appendTo="body" [filter]="true"  filterBy="name" 
                    [showClear]="true" [options]="entityNodeTypeList" optionLabel="name" (onChange)="onEntityNodeTypeSelect($event.value)"
                    placeholder="Select Entity Node Type" autoWidth="true" style="min-width:100%; min-width:10rem;" />
                </div>
                <div class="col-5">       
                    <p-dropdown 
                    appendTo="body" [filter]="true"  filterBy="nodeName" 
                    [showClear]="true" [options]="entityNodeComponnetList" [ngModel]="selectedNodeComponentValue" optionLabel="nodeName" (onChange)="onEntityNodeComponentSelect($event.value)"
                    placeholder="Select Entity Node Component" autoWidth="true" style="min-width:100%; min-width:10rem;" />
                </div>
                <div class="col-1 mt-1" >
                    <p-button  icon="pi pi-plus" severity="success" [rounded]="false" [outlined]="false" class="btnAdd" (click)="addedNode()"/>                          
                </div>
                <div class="col-12 m-0 p-0" >                      
                    <a icon="pi pi-check" class="btn btn-clear ml-3" title="Download JSON" [href]="downloadJsonHref" download="entity-tree.json">Export Entity Tree</a>  
                </div>
                <div class="col-12 flex">
                    <p-tree 
                    class="w-full"
                    [value]="files"
                    [contextMenu]="cm"
                    layout="horizontal" 
                    [filter]="true" 
                    selectionMode="single" 
                    [(selection)]="selectedFiles3" 
                    (onNodeSelect)="nodeSelect($event)" >
                    <ng-template let-node pTemplate="default"> 
                        <b *ngIf="node.data.qty>1">{{node.data.qty}}</b>
                        <b class="tree-node-text"> {{ node.label }}</b>
                        <p-button  icon="pi pi-bars" label="Dimensions" [rounded]="true" [text]="true"  (click)="menu.toggle($event)"/>
                      
                    </ng-template>
                    </p-tree>
                    <p-menu #menu id="config_menu" [model]="dimensionList" [popup]="true" />
                    <p-contextMenu #cm [model]="menuItems" />
                    
                </div>
                <p-contextMenu #sim [model]="suggestItems" [global]="true"></p-contextMenu>
                <div class="col-12 p-fluid">
                    <form [formGroup]="productForm" (ngSubmit)="saveProduct()" *ngIf="showForm">
                        <p-tabView orientation="left" class="w-full">
                            <p-tabPanel header="Node Fields" class="line-height-3 m-0 w-full">                    
                                <div class="grid">                        
                                    <div class="col-12 p-fluid">
                                        <ng-container formArrayName="groupArr">
                                            <ng-container *ngFor="let item of groupArrList().controls; let groupIndex = index">
                                                <div class="grid mt-1" [formGroupName]="groupIndex">
                                                    <div class="col-12 align-items-center justify-content-center p-1">  
                                                        <h4>{{item.value.name}}</h4> 
                                                    </div>
                                                    <ng-container formArrayName="groupArrItems">
                                                        <ng-container *ngFor="let arrItem of groupArrItemsList(groupIndex).controls; let arrIndex = index">
                                                            <ng-container [formGroupName]="arrIndex">
                                                                <div class="col-4">
                                                                    <label for="selectedValue">{{arrItem.value.fieldName}}</label>
                                                                    <ng-container *ngIf="arrItem.value.elementType=='Text'">
                                                                        <input *ngIf="arrItem.value.attributeType=='Required'" type="text" id="selectedValue" pInputText formControlName="selectedValue"  [ngClass]="{ 'ng-invalid ng-dirty': submitted && fiItems(groupIndex,arrIndex,'selectedValue') }" />
                                                                        <input type="text" *ngIf="arrItem.value.attributeType=='Range'" pInputText  [minlength]="arrItem.value.attributeValues.min" [maxlength]="arrItem.value.attributeValues.max" id="selectedValue" formControlName="selectedValue"  [ngClass]="{ 'ng-invalid ng-dirty': submitted && fiItems(groupIndex,arrIndex,'selectedValue') }" />
                                                                        <small id="username-help" *ngIf="arrItem.value.attributeType=='Range'">
                                                                        Range should be selected in between {{arrItem.value.attributeValues.min}} to {{arrItem.value.attributeValues.max}}
                                                                        </small>
                                                                        <p-dropdown 
                                                                            *ngIf="arrItem.value.attributeType=='DropDown'"
                                                                            formControlName="selectedValue" appendTo="body" [filter]="true"  filterBy="name" 
                                                                            [showClear]="true" [options]="arrItem.value.attributeValues" optionLabel="name"
                                                                            placeholder="Select Option" autoWidth="false" class="w-100 w-full md:w-30rem" />
                                                                    </ng-container>
                                                                    <ng-container *ngIf="arrItem.value.elementType=='Number'">
                                                                        <input type="number"                                                   
                                                                        placeholder="0.00"
                                                                        step=".01" pInputText *ngIf="arrItem.value.attributeType=='Required'" id="selectedValue" pInputText formControlName="selectedValue"  [ngClass]="{ 'ng-invalid ng-dirty': submitted && fiItems(groupIndex,arrIndex,'selectedValue') }" />
                                                                        <input type="number"                                                   
                                                                        placeholder="0.00"
                                                                        step=".01" pInputText *ngIf="arrItem.value.attributeType=='Range'"  [min]="arrItem.value.attributeValues.min" [max]="arrItem.value.attributeValues.max" id="selectedValue" formControlName="selectedValue"  [ngClass]="{ 'ng-invalid ng-dirty': submitted && fiItems(groupIndex,arrIndex,'selectedValue') }" />
                                                                        <small id="username-help" *ngIf="arrItem.value.attributeType=='Range'">
                                                                        Range should be selected in between {{arrItem.value.attributeValues.min}} to {{arrItem.value.attributeValues.max}}
                                                                        </small>
                                                                        
                                                                        <p-dropdown 
                                                                        *ngIf="arrItem.value.attributeType=='DropDown'"
                                                                        formControlName="selectedValue" appendTo="body" [filter]="true"  filterBy="name" 
                                                                        [showClear]="true" [options]="arrItem.value.attributeValues" optionLabel="name"
                                                                        placeholder="Select Option" autoWidth="false" class="w-100 w-full md:w-30rem" />
                                                                    </ng-container>
                                                                </div>
                                                            </ng-container>
                                                            
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                
                                </div>                    
                            </p-tabPanel>
                            <p-tabPanel header="Calculations" class="line-height-3 m-0 w-full dimension">
                                <div class="grid">
                                    <div class="col-12 text-right">
                                        <app-view-math-docs></app-view-math-docs>
                                    </div>
                                    <div class="col-6">
                                        <label for="dimension1">Dimension 1</label> <strong class="ml-2"> Total: {{dim1val}}</strong>
                                        <p-autoComplete    
                                        (onFocus)="focusFunction('dimension1')"                                     
                                        [focusOnShow]="false"
                                        formControlName="dimension1"
                                        [suggestions]="suggestions"
                                        (completeMethod)="search($event)"
                                        [multiple]="true"
                                        />
                                    
                                    </div>
                                    <div class="col-6">
                                        <label for="dimension2">Dimension 2</label><strong class="ml-2"> Total: {{dim2val}}</strong>
                                        <p-autoComplete     
                                        (onFocus)="focusFunction('dimension2')"                                     
                                        [focusOnShow]="false"
                                        formControlName="dimension2"
                                        [suggestions]="suggestions"
                                        (completeMethod)="search($event)"
                                        [multiple]="true"
                                        />
                                    </div>
                                    <div class="col-6">
                                        <label for="dimension3">Dimension 3</label><strong class="ml-2"> Total: {{dim3val}}</strong>
                                        <p-autoComplete    
                                        (onFocus)="focusFunction('dimension3')"                                      
                                        [focusOnShow]="false"
                                        formControlName="dimension3"
                                        [suggestions]="suggestions"
                                        (completeMethod)="search($event)"
                                        [multiple]="true"
                                        />
                                    </div>
                                    <div class="col-6">
                                        <label for="dimension4">Dimension 4</label><strong class="ml-2"> Total: {{dim4val}}</strong>
                                        <p-autoComplete    
                                        (onFocus)="focusFunction('dimension4')"                                      
                                        [focusOnShow]="false"
                                        formControlName="dimension4"
                                        [suggestions]="suggestions"
                                        (completeMethod)="search($event)"
                                        [multiple]="true"
                                        />
                                    </div>
                                    <div class="col-12">
                                        <label for="dimension5">Dimension 5</label><strong class="ml-2"> Total:  {{dim5val}}</strong>
                                        <p-autoComplete   
                                        (onFocus)="focusFunction('dimension5')"                                       
                                        [focusOnShow]="false"
                                        formControlName="dimension5"
                                        [suggestions]="suggestions"
                                        (completeMethod)="search($event)"
                                        [multiple]="true"
                                        />
                                    </div>
                                </div>
                            </p-tabPanel>
                        </p-tabView>
                        <div class="grid p-fluid" *ngIf="showForm">
                            <div class="col-2 justify-content-start">
                                <p-button class="pull-right" label="Save" type="submit"  [raised]="true" severity="success" />                                                
                            </div>
                            <div class="col-2 justify-content-start">                            
                                <p-button class="pull-right" label="Cancel" [text]="true" (click)="cancel()" [raised]="true" severity="secondary" />              
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </p-card>
    </div>
    <div class="col-3">
        <p-card header="Performance Indicators">
           <div class="grid p-fluid">
                <div class="col-12 p-0 m-0" >
                    <ul class="p-1" *ngFor="let item of performaceIndicators">
                        <label>{{item.customName}}</label> <strong class="ml-5">{{item.value}}</strong>
                    </ul>
                </div>
           </div>
        </p-card>
    </div>
    <p-dialog [(visible)]="showEntityNodeComponentDlg" header="Save Entity Node component" [modal]="true" [style]="{width:'450px'}">
        <div class="flex">
           <div class="grid w-full">
            <div class="col-12 p-fluid">
                <label for="name" class="block text-700 font-medium mb-2">Node Name</label>                    
                <input type="text" pInputText [(ngModel)]="nodeNameToBeSaved" />                
            </div>
           </div>
        </div>
        <ng-template pTemplate="footer" >
            <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="showEntityNodeComponentDlg = false"></button>
            <button pButton pRipple icon="pi pi-check" class="p-button-text success" label="Save" (click)="saveEntityNodeComponent()"></button>
        </ng-template>
    </p-dialog>
</div>